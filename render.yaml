services:
  - type: web
    name: job-dashboard
    env: python
    plan: free
    rootDir: backend
    pythonVersion: "3.11.9"
    buildCommand: |
      pip install -r requirements.txt &&
      cd ../frontend && npm install && npm run build
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: DATABASE_URL
        value: sqlite+aiosqlite:///./job_dashboard.db   # overwrite with postgres if needed
      - key: CORS_ORIGINS
        value: '["https://job-dashboard.onrender.com"]'
      # Gmail token: base64-encode secrets/token.json and paste here
      # base64 -i backend/secrets/token.json | tr -d '\n'
      - key: GMAIL_TOKEN_JSON
        sync: false   # set manually in Render dashboard (secret)
      - key: GMAIL_TOKEN_FILE
        value: /tmp/gmail_token.json
